# 🧪 راهنمای تست Signal Agent - سیستم تحلیل تکنیکالی

## 📋 فهرست مطالب
1. [معرفی](#معرفی)
2. [نتایج تست](#نتایج-تست)
3. [اندیکاتورهای تکنیکالی](#اندیکاتورهای-تکنیکالی)
4. [تفسیر سیگنال](#تفسیر-سیگنال)
5. [اجرای تست](#اجرای-تست)
6. [بررسی Edge Cases](#بررسی-edge-cases)

---

## 🎯 معرفی

این فایل **تست جامع Signal Agent** است که تمام عملکردهای مدول تحلیل تکنیکالی را بررسی می‌کند.

### مدول تست‌شده
- **Signal Agent**: ماژولی برای تولید سیگنال‌های خرید/فروش
- **Technical Indicators**: 6 اندیکاتور تکنیکالی مختلف
- **Data Layer**: دریافت و پردازش داده‌های بازار

### دستورات اجرا

```bash
# اجرای کامل تست‌ها
cd "c:\Users\r_najafi\Desktop\Projects\Data"
python test_signal_agent.py

# نتایج ذخیره می‌شوند در:
# - results/signal_agent_test_results.json
# - results/signal_agent_test_report.html
# - results/signal_agent_test_summary.txt
```

---

## ✅ نتایج تست

### خلاصه کلی
```
✅ وضعیت کلی: SUCCESS (100% موفقیت)
📊 تعداد تست‌ها: 4 تست اصلی + 4 Edge Case
⏱️  زمان اجرا: ~2.11 ثانیه
📅 تاریخ: 27 اکتبر 2025
```

### نتایج تفصیلی

#### ✅ تست 1: دریافت داده‌های بازار
```
نتیجه: PASSED ✅

📊 داده‌های دریافت شده:
   • نماد: XAU/USD (طلا)
   • تعداد کندل: 200
   • بازه: 1 ساعت
   • منبع: Twelve Data API
   
💰 آمار قیمت‌ها:
   • قیمت فعلی: $4,281.35
   • کمینه: $4,016.89
   • بیشینه: $4,436.75
   • میانگین: $4,187.63
   • دامنه: $419.86
```

#### ✅ تست 2: محاسبه اندیکاتورها
```
نتیجه: PASSED ✅

📈 تمام 6 اندیکاتور محاسبه شدند:
   1. SMA (Simple Moving Average) ✓
   2. EMA (Exponential Moving Average) ✓
   3. RSI (Relative Strength Index) ✓
   4. MACD (Moving Avg Convergence Divergence) ✓
   5. Bollinger Bands ✓
   6. ATR (Average True Range) ✓
```

#### ✅ تست 3: تولید سیگنال
```
نتیجه: PASSED ✅

🎯 سیگنال نهایی:
   • مقدار: 0.2496
   • اعتماد: 67.04% ⭐⭐⭐⭐
   • تفسیر: 🟢 خرید (Buy)
   • وضعیت: قابل اعتماد
```

#### ✅ تست 4: صحت‌سنجی سیگنال
```
نتیجه: PASSED ✅

✓ محدوده سیگنال (-1 تا 1): معتبر ✅
✓ محدوده Confidence (0 تا 1): معتبر ✅
✓ نوع Agent: signal ✅
✓ Metadata کامل: ✅
✓ سازگاری اندیکاتورها: 50% ✅
```

---

## 📈 اندیکاتورهای تکنیکالی

### 1. SMA (Simple Moving Average - میانگین متحرک ساده)
```
مقدار:
   • SMA 20: $4,369.04
   • SMA 50: $4,300.91

تفسیر:
   ✓ SMA 20 > SMA 50 = روند صعودی
   ✓ قیمت بالاتر است از میانگین کوتاه‌مدت
   
سیگنال: 🟢 خرید
```

### 2. EMA (Exponential Moving Average - میانگین متحرک نمایی)
```
مقدار:
   • EMA 12: $4,331.35
   • EMA 26: $4,334.46

تفسیر:
   ✓ EMA سریع‌تر به تغییرات واکنش نشان می‌دهد
   ✓ استفاده برای تشخیص تغییرات روند
   
سیگنال: → خنثی (در حال بررسی)
```

### 3. RSI (Relative Strength Index - شاخص قدرت نسبی)
```
مقدار: 29.03
محدوده: 0-100

وضعیت: ⬇️ اشباع فروشی (Oversold)
   • RSI < 30 = اشباع فروشی
   • احتمال بازخورت قیمت به بالا

سیگنال: 🟢 بازخورت انتظار می‌رود
```

### 4. MACD (Moving Average Convergence Divergence)
```
مقادیر:
   • MACD Line: -3.1062
   • Signal Line: -2.7956
   • Histogram: -0.3106

وضعیت: 📉 نزولی
   ✓ MACD < Signal = تقاطع منفی
   ✓ Histogram منفی = فشار فروش

سیگنال: 🔴 فروش (مخالف روند صعودی!)
تضاد: روند صعودی ولی MACD نزولی = تحذیر
```

### 5. Bollinger Bands (نوار بولینجر)
```
مقادیر:
   • Upper Band: $4,461.75
   • Middle Band: $4,369.04
   • Lower Band: $4,276.34

موقعیت قیمت: 📉 نزدیک باند پایینی
   ✓ قیمت فعلی ($4,281) بسیار نزدیک Lower Band
   ✓ نشان‌دهنده سطح حمایت قوی
   ✓ فرصت خرید

سیگنال: 🟢 حمایت و فرصت خرید
```

### 6. ATR (Average True Range - دامنه واقعی متوسط)
```
مقدار: 61.62

سطح نوسان: 📊 زیاد
   ✓ نوسان‌پذیری بالاتر از حالت عادی
   ✓ فرصت‌های معاملاتی بیشتر
   ✓ ریسک بالاتر

سیگنال: ⚡ بازار فعال
```

---

## 🎯 تفسیر سیگنال

### سیگنال نهایی
```
🟢 خرید (Buy)
Signal Value: 0.2496
Confidence: 67.04% ⭐⭐⭐⭐
```

### معنی سیگنال
```
-1.0 ←─────────→ 0.0 ←─────────→ +1.0
🔴 فروش      خنثی      🟢 خرید
(Strong)    (Neutral)   (Strong)

مقدار فعلی: 0.2496 = خرید متوسط
```

### سطح اعتماد
```
0% ──────────────────────────────── 100%
⭐          ⭐⭐⭐⭐        ⭐⭐⭐⭐⭐
خیلی کم      متوسط      خیلی زیاد

مقدار فعلی: 67% = اعتماد خوب
```

---

## 🔬 بررسی Edge Cases

### Case 1: داده ناکافی (10 کندل)
```
شرایط: تعداد کندل‌ها کمتر از حداقل مورد نیاز
نتیجه:
   • Signal: 0.0
   • Confidence: 0.0
   • وضعیت: صحیح! ✅ (به جای تولید سیگنال غلط، خنثی)
```

### Case 2: بازار صعودی (100 کندل افزایشی)
```
شرایط: تمام قیمت‌ها به صورت منظم بالا می‌روند
نتیجه:
   • Signal: 0.1126 ✅
   • Confidence: 66.89%
   • تفسیر: 🟢 خرید
   • صحیح: سیگنال خرید برای بازار صعودی ✓
```

### Case 3: بازار نزولی (100 کندل کاهشی)
```
شرایط: تمام قیمت‌ها به صورت منظم پایین می‌روند
نتیجه:
   • Signal: -0.1126 ✅
   • Confidence: 66.89%
   • تفسیر: 🔴 فروش
   • صحیح: سیگنال فروش معکوس تماماً ✓
```

### Case 4: بازار جانبی (100 کندل ثابت)
```
شرایط: قیمت ثابت و بدون تغییر واضح
نتیجه:
   • Signal: NaN (خنثی)
   • Confidence: 95%
   • تفسیر: وضعیت خنثی
   • صحیح: عدم تولید سیگنال کاذب ✓
```

---

## 🧪 اجرای تست

### نیازمندی‌ها
```bash
pip install pydantic numpy pandas scikit-learn requests
```

### اجرای ساده
```bash
python test_signal_agent.py
```

### خروجی
```
🧪 تست جامع Signal Agent - سیستم تحلیل تکنیکال طلا
════════════════════════════════════════════════════

✅ 1️⃣ تست دریافت داده‌های بازار ... PASSED
✅ 2️⃣ تست محاسبه اندیکاتورهای تکنیکالی ... PASSED
✅ 3️⃣ تست تولید سیگنال ... PASSED
✅ 4️⃣ تست صحت‌سنجی سیگنال ... PASSED
✅ 5️⃣ تست موارد حدی (Edge Cases) ... PASSED

📋 خلاصه نتایج تست
────────────────────────────────────
✅ تمام تست‌ها موفق بودند!
```

---

## 📊 فایل‌های نتیجه

### 1. `signal_agent_test_results.json`
```json
{
  "timestamp": "2025-10-27T17:27:25.698892",
  "test_results": {
    "data_retrieval": {...},
    "indicators_calculation": {...},
    "signal_generation": {...},
    "signal_validation": {...},
    "edge_cases": {...}
  }
}
```
📌 **برای**: پردازش برنامه‌ای و تجزیه‌تحلیل

### 2. `signal_agent_test_report.html`
```html
<!-- گزارش بصری و تعاملی -->
<!-- باز کردن در مرورگر برای نمایش بهتر -->
```
📌 **برای**: مرورگر و نمایش گرافیکی

### 3. `signal_agent_test_summary.txt`
```
📋 خلاصه متنی کامل تمام نتایج
```
📌 **برای**: چاپ و مرجع سریع

---

## 💡 نکات مهم

### 1. تفاوت اندیکاتورها
```
SMA vs EMA:
   • SMA: میانگین ساده (وزن برابر)
   • EMA: میانگین وزن‌دار (قیمت‌های اخیر بیشتر)
   
RSI vs MACD:
   • RSI: اشباع و سطح‌های قیمت
   • MACD: روند و تغییر جهت
   
Bollinger Bands vs ATR:
   • BB: سطح‌های حمایت و مقاومت
   • ATR: سطح نوسان‌پذیری
```

### 2. تعارض‌های سیگنال
```
مثال از این تست:
   • SMA: صعودی (Buy) ✓
   • MACD: نزولی (Sell) ✗
   • RSI: Oversold (BuyBack) ✓
   
نتیجه نهایی: خرید (توازن اندیکاتورها)
```

### 3. اهمیت Confidence
```
67% اعتماد = سیگنال قابل اعتماد
   • بیشتر از 60% = خوب
   • بیشتر از 80% = عالی
   • کمتر از 40% = ضعیف (نادیده بگیرید)
```

---

## 🚀 استفاده عملی

### برای معامله‌گران
```python
from agents import SignalAgent
from data_layer import TwelveDataClient

client = TwelveDataClient()
agent = SignalAgent()

# دریافت داده
market_data = client.get_time_series("XAU/USD", "1h", 200)

# تولید سیگنال
signal = agent.analyze(market_data)

# بررسی
if signal.signal > 0.5 and signal.confidence > 0.7:
    print(f"🟢 خرید قوی! Confidence: {signal.confidence:.0%}")
elif signal.signal < -0.5 and signal.confidence > 0.7:
    print(f"🔴 فروش قوی! Confidence: {signal.confidence:.0%}")
```

### برای توسعه‌دهندگان
```python
# تست اجزای جداگانه
indicator = TechnicalIndicators()

rsi = indicator.calculate_rsi(prices, 14)
macd = indicator.calculate_macd(prices)
bb = indicator.calculate_bollinger_bands(prices)

# بررسی مقادیر
assert 0 <= rsi <= 100
assert -1 <= macd[0] <= 1  # normalized
```

---

## ❓ سوالات متداول

### Q1: چرا سیگنال و MACD متفاوت‌اند؟
```
جواب: سیگنال نهایی ترکیبی از تمام اندیکاتورها است،
نه فقط یکی. MACD فقط یک از 6 اندیکاتور است.
```

### Q2: آیا 67% اعتماد کافی است برای معامله؟
```
جواب: بله، اما با مدیریت ریسک:
   • Stop Loss: $4,270
   • Target: $4,310+
   • ریسک/سود: 1:2+
```

### Q3: چگونه از تست‌ها استفاده کنم؟
```
جواب: نتایج JSON را بر طریق برنامه‌تان parse کنید:
   json.load(open('signal_agent_test_results.json'))
```

---

## 📞 تماس و پشتیبانی

برای مسائل یا سوالات:
- 📧 Email: support@gold-trading.local
- 📋 Issues: GitHub Issues
- 📚 Docs: `/docs/` directory

---

**آخرین بروزرسانی**: 27 اکتبر 2025
**نسخه**: 2.0.0
**وضعیت**: ✅ تمام تست‌ها موفق
